
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>مزاد القادحات لمزاد الخيل</title>
<style>
    body {margin:0; font-family: Arial, sans-serif; background:#f5f5f5;}
    .page {display:none; padding:20px; text-align:center;}
    .active {display:block;}
    h1, h2, h3 {color:#5a381e;}
    button {background:#b8860b; color:#fff; padding:12px 20px; border:none; border-radius:8px; font-size:18px; cursor:pointer; margin:10px;}
    button:hover {background:#8b6914;}
    input, textarea {width:90%; padding:10px; margin:10px 0; border-radius:6px; border:1px solid #ccc; font-size:16px;}
    .back-btn {background:#555;}
    .horse-card {background:#fff; margin:10px auto; padding:10px; border-radius:8px; width:90%; box-shadow:0 0 5px rgba(0,0,0,0.1); text-align:right;}
    .timer {color:red; font-weight:bold;}
    .horse-thumb {max-width:100px; max-height:100px; border-radius:6px; display:block; margin-bottom:10px;}
    .bid-info {background:#f0f0f0; padding:8px; border-radius:6px; margin-top:8px;}
    .popup {display:none; position:fixed; z-index:1000; padding-top:50px; left:0; top:0; width:100%; height:100%; overflow:auto; background-color:rgba(0,0,0,0.8);}
    .popup-content {background:#fff; margin:auto; padding:20px; border-radius:8px; width:90%; max-width:500px; position:relative;}
    .popup-content img {max-width:100%; margin-bottom:10px; border-radius:6px;}
    .close-btn {position:absolute; top:10px; left:10px; background:#b8860b; color:#fff; border:none; padding:5px 10px; border-radius:5px; cursor:pointer;}
</style>
</head>
<body>

<div id="welcomePage" class="page active">
    <h1>مرحبا بكم في مزاد القادحات لمزاد الخيل</h1>
    <button onclick="showPage('registerPage')">ابدأ</button>
</div>

<div id="registerPage" class="page">
    <h2>تسجيل المشترك</h2>
    <input type="text" id="userName" placeholder="الاسم الثلاثي والقبيلة">
    <input type="text" id="userPhone" placeholder="رقم الجوال">
    <button onclick="saveUser()">متابعة</button>
    <button class="back-btn" onclick="showPage('welcomePage')">رجوع</button>
</div>

<div id="menuAfterRegister" class="page">
    <h2>القائمة</h2>
    <button onclick="showPage('auctionPage')">دخول المزاد</button>
    <button onclick="showPage('addHorsePage')">إضافة خيل للمزاد</button>
</div>

<div id="addHorsePage" class="page">
    <h2>إضافة خيل</h2>
    <input type="text" id="horseName" placeholder="اسم الخيل">
    <input type="text" id="horseAge" placeholder="العمر">
    <input type="text" id="horseHealth" placeholder="الحالة الصحية">
    <textarea id="horseDetails" placeholder="إنجازات الخيل وتفاصيله"></textarea>
    <label>اختر حتى 5 صور للخيل:</label>
    <input type="file" id="horseImages" multiple accept="image/*">
    <label>صورة جواز الخيل (اختياري):</label>
    <input type="file" id="horsePassport" accept="image/*">
    <button onclick="saveHorse()">حفظ</button>
    <button class="back-btn" onclick="showPage('menuAfterRegister')">رجوع</button>
</div>

<div id="auctionPage" class="page">
    <h2>المزاد</h2>
    <div id="auctionList"></div>
    <button class="back-btn" onclick="showPage('menuAfterRegister')">رجوع</button>
</div>

<div id="popup" class="popup" onclick="closePopup(event)">
    <div class="popup-content" id="popupContent">
        <button class="close-btn" onclick="document.getElementById('popup').style.display='none'">إغلاق</button>
    </div>
</div>

<script>
let horses = JSON.parse(localStorage.getItem('horses')) || [];

function showPage(id){
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    if(id==='auctionPage') renderAuction();
}

function saveUser(){
    localStorage.setItem('userName', document.getElementById('userName').value);
    localStorage.setItem('userPhone', document.getElementById('userPhone').value);
    showPage('menuAfterRegister');
}

function saveHorse(){
    const images = Array.from(document.getElementById('horseImages').files).slice(0,5).map(f=>URL.createObjectURL(f));
    const horse = {
        name: document.getElementById('horseName').value,
        age: document.getElementById('horseAge').value,
        health: document.getElementById('horseHealth').value,
        details: document.getElementById('horseDetails').value,
        owner: localStorage.getItem('userName'),
        phone: localStorage.getItem('userPhone'),
        startTime: Date.now(),
        highestBidder: null,
        highestBid: null,
        images: images,
        passport: document.getElementById('horsePassport').files[0] ? URL.createObjectURL(document.getElementById('horsePassport').files[0]) : null
    };
    horses.push(horse);
    localStorage.setItem('horses', JSON.stringify(horses));
    alert('تم حفظ الخيل بنجاح');
    showPage('menuAfterRegister');
}

function renderAuction(){
    const container=document.getElementById('auctionList');
    container.innerHTML='';
    horses.forEach((h,index)=>{
        const card=document.createElement('div');
        card.className='horse-card';
        const timerId='timer-'+index;
        const thumb = h.images && h.images.length > 0 ? `<img src="${h.images[0]}" class="horse-thumb">` : '';
        card.innerHTML=`
            ${thumb}
            <h3>${h.name}</h3>
            <p>الحالة الصحية: ${h.health}</p>
            <p>الإنجازات: ${h.details || 'لا يوجد'}</p>
            <div class="bid-info">
                <p>أعلى مزايد: ${h.highestBidder ? h.highestBidder + ' - ' + h.phone : 'لا يوجد'}</p>
                <p>المبلغ الحالي: ${h.highestBid ? h.highestBid + ' ريال' : '-'}</p>
            </div>
            <p class="timer" id="${timerId}"></p>
            <button onclick="openPopup(${index})">عرض الصور والجواز</button>
            <input type="number" id="bidAmount-${index}" placeholder="أدخل مبلغ المزايدة">
            <button onclick="placeBid(${index})">مزايدة</button>
        `;
        container.appendChild(card);
        startTimer(h.startTime, timerId);
    });
}

function placeBid(index){
    const amount=parseFloat(document.getElementById(`bidAmount-${index}`).value);
    if(!amount){
        alert('أدخل مبلغ المزايدة');
        return;
    }
    const name = localStorage.getItem('userName');
    const phone = localStorage.getItem('userPhone');
    horses[index].highestBidder=name;
    horses[index].highestBid=amount;
    horses[index].phone=phone;
    localStorage.setItem('horses', JSON.stringify(horses));
    renderAuction();
}

function startTimer(startTime, elementId){
    function updateTimer(){
        const now=Date.now();
        const diff=24*60*60*1000 - (now - startTime);
        if(diff<=0){
            document.getElementById(elementId).innerText='انتهى المزاد';
            return;
        }
        const hours=Math.floor(diff/(1000*60*60));
        const minutes=Math.floor((diff%(1000*60*60))/(1000*60));
        const seconds=Math.floor((diff%(1000*60))/1000);
        document.getElementById(elementId).innerText=`${hours}:${minutes}:${seconds}`;
        setTimeout(updateTimer,1000);
    }
    updateTimer();
}

function openPopup(index){
    const horse=horses[index];
    const popupContent=document.getElementById('popupContent');
    popupContent.innerHTML='<button class="close-btn" onclick="document.getElementById(\'popup\').style.display=\'none\'">إغلاق</button>';
    if(horse.images && horse.images.length>0){
        horse.images.forEach(img=>{
            const imageEl=document.createElement('img');
            imageEl.src=img;
            popupContent.appendChild(imageEl);
        });
    }
    if(horse.passport){
        const passportImg=document.createElement('img');
        passportImg.src=horse.passport;
        popupContent.appendChild(passportImg);
    }
    document.getElementById('popup').style.display='block';
}

function closePopup(event){
    if(event.target.id==='popup'){
        document.getElementById('popup').style.display='none';
    }
}
</script>

</body>
</html>
